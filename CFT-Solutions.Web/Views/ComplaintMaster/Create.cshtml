@model CFT_Solutions.Core.Entity.ComplaintMaster.ComplaintMasterEntity
@{
    bool isViewMode = ViewBag.IsView ?? false;
    bool isEditable = Model.StatusId == 1 && !isViewMode;
  
}

<!DOCTYPE html>
<html>
<head>
    <title>@(isViewMode ? "View Complaint" : "Submit Complaint")</title>
    <link href="~/lib/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet" />
    <style>
        .form-control[readonly],
        .form-control:disabled {
            background-color: #f8f9fa;
            opacity: 1;
        }

        .view-mode-label {
            font-weight: bold;
            color: #495057;
        }

        /* Optional: tighten spacing on very small screens */
        @@media (max-width: 575.98px) {
            .form-group

        {
            margin-bottom: 0.75rem;
        }

        }
    </style>
</head>
<body>
    <div class="container mt-4 mb-4">
        <h2 class="mb-4 text-center text-md-start">
            @(isViewMode ? "View Complaint" : "Submit Complaint")
        </h2>

        @if (isViewMode)
        {
            <div class="alert alert-info">
                <i class="fas fa-eye"></i> You are in view-only mode. All fields are read-only.
            </div>
        }

        <div id="complaintForm">
            @Html.HiddenFor(x => x.Id)
            @Html.HiddenFor(x => x.CustomerName)
            @Html.HiddenFor(x => x.MobileNumber)
            @Html.HiddenFor(x => x.CustomerEmail)
            @Html.HiddenFor(x => x.Address)
            @Html.HiddenFor(x => x.StatusId)

            <input type="hidden" id="complaintId" value="@Model.Id" />
            <input type="hidden" id="currentStatusId" value="@Model.StatusId" />
            <input type="hidden" id="isViewMode" value="@isViewMode.ToString().ToLower()" />

            <!-- Row 1 -->
            <div class="row g-3">
                <!-- Customer -->
                <div class="col-12 col-sm-6 col-md-3">
                    <div class="form-group">
                        <label>Select Customer <span class="text-danger">*</span></label>

                        @if (isEditable || Model.Id == 0)
                        {
                            @Html.DropDownListFor(x => x.CustomerId,
                            new SelectList(Model.CustomersList, "Id", "Name", Model.CustomerId),
                                                "Select Customer",
                                                new { @class = "form-control", id = "customerid", required = "required" })
                                                }
                        else
                        {
                            @Html.DropDownListFor(x => x.CustomerId,
                            new SelectList(Model.CustomersList, "Id", "Name", Model.CustomerId),
                                                "Select Customer",
                                                new { @class = "form-control", id = "customerid", disabled = "disabled", required = "required" })

                        @Html.HiddenFor(x => x.CustomerId)
                                                }

                        @Html.ValidationMessageFor(x => x.CustomerId, "", new { @class = "text-danger" })
                    </div>
                </div>

                <!-- Customer Name -->
                <div class="col-12 col-sm-6 col-md-3">
                    <div class="form-group">
                        <label>Customer Name</label>
                        @Html.TextBoxFor(x => x.CustomerName,
                        new
                        {
                            @class = "form-control",
                            id = "txtCustomerName",
                            @readonly = "readonly",
                            placeholder = "Select customer to populate"
                        })
                    </div>
                </div>

                <!-- Mobile -->
                <div class="col-12 col-sm-6 col-md-3">
                    <div class="form-group">
                        <label>Mobile Number</label>
                        @Html.TextBoxFor(x => x.MobileNumber,
                                                new
                                                {
                                                    @class = "form-control",
                                                    id = "txtMobileNumber",
                                                    @readonly = "readonly",
                                                    placeholder = "Select customer to populate"
                                                })
                    </div>
                </div>

                <!-- Email -->
                <div class="col-12 col-sm-6 col-md-3">
                    <div class="form-group">
                        <label>Email</label>
                        @Html.TextBoxFor(x => x.CustomerEmail,
                                                new
                                                {
                                                    @class = "form-control",
                                                    type = "email",
                                                    id = "txtEmail",
                                                    @readonly = "readonly",
                                                    placeholder = "Select customer to populate"
                                                })
                    </div>
                </div>
            </div>

            <!-- Row 2 -->
            <div class="row g-3 mt-2">
                <!-- Nature Of Complaint -->
                <div class="col-12 col-md-3">
                    <div class="form-group">
                        <label>Nature Of Complaint <span class="text-danger">*</span></label>

                        @if (isEditable || Model.Id == 0)
                        {
                            <select name="NatureOfComplaintId"
                                    class="form-control"
                                    id="natureofcomplaintId"
                                    required>
                                <option value="">Select Nature</option>
                                @foreach (var item in Model.NatureOfComplaintsList)
                                {
                                    <option value="@item.Id"
                                            selected="@(item.Id == Model.NatureOfComplaintId)">
                                        @item.Name
                                    </option>
                                }
                            </select>
                        }
                        else
                        {
                            <select name="NatureOfComplaintId"
                                    class="form-control"
                                    id="natureofcomplaintId"
                                    disabled
                                    required>
                                <option value="">Select Nature</option>
                                @foreach (var item in Model.NatureOfComplaintsList)
                                {
                                    <option value="@item.Id"
                                            selected="@(item.Id == Model.NatureOfComplaintId)">
                                        @item.Name
                                    </option>
                                }
                            </select>
                            <input type="hidden" name="NatureOfComplaintId" value="@Model.NatureOfComplaintId" />
                        }

                        @Html.ValidationMessageFor(x => x.NatureOfComplaintId, "", new { @class = "text-danger" })
                    </div>
                </div>

                <!-- Address -->
                <div class="col-12 col-md-6">
                    <div class="form-group">
                        <label>Address</label>
                        @Html.TextBoxFor(x => x.Address,
                        new
                        {
                            @class = "form-control",
                            id = "txtAddress",
                            @readonly = "readonly",
                            placeholder = "Select customer to populate"
                        })
                    </div>
                </div>

                <!-- Assign Engineer -->
                <div class="col-12 col-md-3">
                    <div class="form-group">
                        <label>Assign Engineer <span class="text-danger">*</span></label>

                        @if (isEditable || Model.Id == 0)
                        {
                            <select name="EngineerId"
                                    class="form-control"
                                    id="engineerid"
                                    required>
                                <option value="">Select Engineer</option>
                                @foreach (var item in Model.EngineerList)
                                {
                                    <option value="@item.Id"
                                            selected="@(item.Id == Model.EngineerId)">
                                        @item.Name
                                    </option>
                                }
                            </select>
                        }
                        else
                        {
                            <select name="EngineerId"
                                    class="form-control"
                                    id="engineerid"
                                    disabled
                                    required>
                                <option value="">Select Engineer</option>
                                @foreach (var item in Model.EngineerList)
                                {
                                    <option value="@item.Id"
                                            selected="@(item.Id == Model.EngineerId)">
                                        @item.Name
                                    </option>
                                }
                            </select>
                            <input type="hidden" name="EngineerId" value="@Model.EngineerId" />
                        }

                        @Html.ValidationMessageFor(x => x.EngineerId, "", new { @class = "text-danger" })
                    </div>
                </div>
            </div>

            <!-- Complaint Details -->
            <div class="row g-3 mt-2">
                <div class="col-12">
                    <div class="form-group">
                        <label>Complaint Details <span class="text-danger">*</span></label>

                        @if (isEditable || Model.Id == 0)
                        {
                            @Html.TextAreaFor(x => x.ComplaintDetails, 4, 100,
                            new { @class = "form-control", id = "complaintdetails", required = "required" })
                                                }
                        else
                        {
                            @Html.TextAreaFor(x => x.ComplaintDetails, 4, 100,
                            new { @class = "form-control bg-light", id = "complaintdetails", @readonly = "readonly", required = "required" })
                                                }

                        @Html.ValidationMessageFor(x => x.ComplaintDetails, "", new { @class = "text-danger" })
                    </div>
                </div>
            </div>

            <!-- Status Field -->
            @if (Model.StatusId != 1 && !isViewMode && Model.Id > 0)
            {
                <div class="row g-3 mt-2">
                    <div class="col-12 col-sm-6 col-md-3">
                        <div class="form-group">
                            <label>Select Status <span class="text-danger">*</span></label>

                            @Html.DropDownListFor(x => x.StatusId,
                            new SelectList(Model.StatusList, "Id", "Name", Model.StatusId),
                                                "Select Status",
                                                new { @class = "form-control", id = "statusid", required = "required" })

                        @Html.ValidationMessageFor(x => x.StatusId, "", new { @class = "text-danger" })
                    </div>
                </div>
                <div class="row g-3 mt-2">
                    <div class="col-12 col-sm-6 col-md-3">
                    <div class="form-group">
                        <label> Remark <span class="text-danger">*</span></label>

                            @Html.TextAreaFor(x => x.Remark, 4, 100,
                                                        new { @class = "form-control bg-light", id = "Remark", required = "required" })
                            @Html.ValidationMessageFor(x => x.Remark, "", new { @class = "text-danger" })
                    </div>
                    </div>
                </div>
            </div>
              }
            else if (Model.StatusId != 1 && isViewMode)
            {
                <div class="row g-3 mt-2">
                    <div class="col-12 col-sm-6 col-md-3">
                        <div class="form-group">
                            <label class="view-mode-label">Current Status</label>
                            <div class="form-control bg-light">
                                @{
                                    var currentStatus = Model.StatusList?.FirstOrDefault(s => s.Id == Model.StatusId);
                                    var statusName = currentStatus?.Name ?? "Unknown";
                                }
                                @statusName
                            </div>
                            @Html.HiddenFor(x => x.StatusId)
                        </div>
                    </div>
                </div>
                <div class="row g-3 mt-2">
                    <div class="col-12 col-sm-6 col-md-3">
                        <div class="form-group">
                            <label> Remark <span class="text-danger">*</span></label>

                            @Html.TextAreaFor(x => x.Remark, 4, 100,
                            new { @class = "form-control bg-light", id = "Remark", required = "required" })
                        @Html.ValidationMessageFor(x => x.Remark, "", new { @class = "text-danger" })
                    </div>
                </div>
            </div>
            }

            <!-- Buttons -->
            <div class="form-group mt-4">
                <div class="d-flex flex-column flex-sm-row flex-wrap gap-2">
                    <a href="@Url.Action("Index", "ComplaintMaster")" class="btn btn-secondary">
                        <i class="fas fa-arrow-left"></i> Back to List
                    </a>

                    @if (!isViewMode)
                    {
                        if (Model.StatusId == 1 || Model.Id == 0)
                        {
                            <button type="button" id="btnSaveDraft" class="btn btn-warning">
                                <i class="fas fa-save"></i> Save Draft
                            </button>

                            <button type="button" id="btnSubmit" class="btn btn-primary">
                                <i class="fas fa-paper-plane"></i> Submit Complaint
                            </button>
                        }
                        else if (Model.StatusId != 1 || Model.Id > 0)
                        {
                            <button type="button" id="btnUpdateStatus" class="btn btn-success">
                                <i class="fas fa-sync-alt"></i> Update Status
                            </button>
                        }
                    }
                    else
                    {
                        @if (User.IsInRole("Admin"))
                        {
                            <a href="@Url.Action("Create", "ComplaintMaster", new { Id = Model.Id })" class="btn btn-warning">
                                <i class="fas fa-edit"></i> Edit Complaint
                            </a>
                        }
                    }
                </div>
            </div>
        </div>
    </div>

    <script src="~/lib/jquery/dist/jquery.min.js"></script>
    <script src="~/lib/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
    <script src="~/lib/bootbox.min.js"></script>
    <script src="~/custom/complaintmaster/complaintmaster.js"></script>
    <script>
        var isViewMode = $('#isViewMode').val() === 'true';

        if (isViewMode) {
            $(document).ready(function () {
                $('#complaintForm input, #complaintForm select, #complaintForm textarea, #complaintForm button')
                    .not('.btn-secondary, .btn-info, .btn-warning')
                    .prop('disabled', true)
                    .addClass('bg-light');
            });
        }
    </script>

</body>
</html>
